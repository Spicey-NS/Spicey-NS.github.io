<!DOCTYPE html>
<html>
<body>
  <div class="container">
    <ul id="perk-title-list"></ul>
  </div>

  <script>
    fetch("https://www.nationstates.net/cgi-bin/api.cgi?q=dispatch;dispatchid=2669317", {
    })
    .then(response => response.text())
    .then(str => {
      const parser = new DOMParser();
      const xml = parser.parseFromString(str, "application/xml");

      const title = xml.querySelector("TITLE")?.textContent || "No title";
      const text = xml.querySelector("TEXT")?.textContent || "No content";

      const startString = "[anchor=LEVELING]LEVELING SYSTEM[/anchor]"
      const startIndex = text.indexOf(startString) + startString.length();
      const endIndex = text.indexOf("[anchor=LEVELING]LEVELING SYSTEM[/anchor]");

      const trimmedText = text.substring(startIndex, endIndex);

      const titleRegex = /(?<=\[size=250\])(.*?)(?=\[\/size])/gi;
      const titleMatches = [...trimmedText.matchAll(titleRegex)];

      console.log(titleMatches);
      
      const listElement = document.getElementById('perk-title-list');
      listElement.innerHTML = ``;

      for (const match of titleMatches) {
        const itemText = match[0];
        const li = document.createElement('li');
        li.textContent = itemText;
        listElement.appendChild(li);
      }
    })
    .catch(err => {
      console.error("Error:", err);
    });
  </script>
</body>
</html>
