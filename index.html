<!DOCTYPE html>
<html>
<body>
  <div class="container">
    <div id="perk-title-list"></div>
  </div>

  <script>
    fetch("https://www.nationstates.net/cgi-bin/api.cgi?q=dispatch;dispatchid=2669317", {
    })
    .then(response => response.text())
    .then(str => {
      const parser = new DOMParser();
      const xml = parser.parseFromString(str, "application/xml");

      const title = xml.querySelector("TITLE")?.textContent || "No title";
      const text = xml.querySelector("TEXT")?.textContent || "No content";

      const startString = "[anchor=PERKS]PERKS[/anchor]";
      const startIndex = text.indexOf(startString) + startString.length;
      const endIndex = text.indexOf("[anchor=LEVELING]LEVELING SYSTEM[/anchor]");

      const trimmedText = text.substring(startIndex, endIndex);

      console.log(trimmedText);
      
      const titleRegex = /(?<=\[size=250\])(.*?)(?:\[\/size]\s*\[size=150\])(.*?)(?:\[\/size]\s*\[size=150\])(.*?)(?=\[\/size\])/g;
      const titleMatches = trimmedText.matchAll(titleRegex);

      console.log(titleMatches);
      
      const listElement = document.getElementById('perk-title-list');
      listElement.innerHTML = ``;

      for (const match of titleMatches) {
        console.log(match);
        const perkTitle = match[1];
        const reqs = match[2];
        const reqsRegex = /[1-9]\s*((survival)|(presence)|(civilization)|(army)|(economy)|(luck)|(intelligence))/gi;
        const parsedReqs = match[2].match(reqsRegex)
        console.log(parsedReqs);
        const desc = match[3];
        
        const card = document.createElement('div');
        card.style.border = '1px solid #ccc';
        card.style.borderRadius = '8px';
        card.style.padding = '1rem';
        card.style.marginBottom = '1rem';
        card.style.backgroundColor = '#f9f9f9';

        const h3 = document.createElement('h3');
        h3.textContent = perkTitle;
        card.appendChild(h3);
      
        const ul = document.createElement('ul');
        const li1 = document.createElement('li');
        li1.textContent = reqs;
        ul.appendChild(li1);
        const li2 = document.createElement('li');
        li2.textContent = desc;
        ul.appendChild(li2);
      
        card.appendChild(ul);
        listElement.appendChild(card);
      }
    })
    .catch(err => {
      console.error("Error:", err);
    });
  </script>
</body>
</html>
