<!DOCTYPE html>
<html>
<body>
  <div class="container">
    <h1>NationStates Dispatch</h1>
    <div id="dispatch-content">Loading...</div>
  </div>

  <script>
    fetch("https://www.nationstates.net/cgi-bin/api.cgi?q=dispatch;dispatchid=2669317", {
    })
    .then(response => response.text())
    .then(str => {
      const parser = new DOMParser();
      const xml = parser.parseFromString(str, "application/xml");

      const title = xml.querySelector("TITLE")?.textContent || "No title";
      const text = xml.querySelector("TEXT")?.textContent || "No content";

      const startIndex = text.indexOf("[anchor=PERKS]PERKS[/anchor]");
      const endIndex = text.indexOf("[anchor=LEVELING]LEVELING SYSTEM[/anchor]");

      const trimmedText = text.substring(startIndex, endIndex);

      document.getElementById("dispatch-content").innerHTML = `
        <h2>${title}</h2>
        <div>${trimmedText}</div>
      `;
    })
    .catch(err => {
      document.getElementById("dispatch-content").innerText = "Failed to load dispatch.";
      console.error("Error fetching dispatch:", err);
    });
  </script>
</body>
</html>
